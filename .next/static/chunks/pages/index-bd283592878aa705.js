(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(8987)}])},6258:function(e,t,s){"use strict";s.d(t,{Ed:function(){return h},IS:function(){return d},Qu:function(){return n},R0:function(){return g},T3:function(){return c},Vp:function(){return o},XH:function(){return r},Xw:function(){return i},_8:function(){return m},lM:function(){return x},tB:function(){return l}});var a=s(5893);s(7294);let r=e=>{let{className:t="h-5 w-5"}=e;return(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z",clipRule:"evenodd"})})},n=e=>{let{className:t="h-5 w-5"}=e;return(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z",clipRule:"evenodd"})})},l=e=>{let{className:t="h-5 w-5"}=e;return(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})},i=e=>{let{className:t="h-5 w-5"}=e;return(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 20 20",fill:"currentColor",children:[(0,a.jsx)("path",{d:"M5 4a1 1 0 00-2 0v1.5a.5.5 0 00.5.5h1a.5.5 0 00.5-.5V4zM5 8a1 1 0 00-2 0v1.5a.5.5 0 00.5.5h1a.5.5 0 00.5-.5V8zM10 4a1 1 0 100-2 1 1 0 000 2zM8 8a1 1 0 100-2 1 1 0 000 2zm2 0a1 1 0 100-2 1 1 0 000 2zm2 0a1 1 0 100-2 1 1 0 000 2zm-2 4a1 1 0 100-2 1 1 0 000 2zm2 0a1 1 0 100-2 1 1 0 000 2z"}),(0,a.jsx)("path",{fillRule:"evenodd",d:"M2 3a1 1 0 011-1h14a1 1 0 011 1v14a1 1 0 01-1 1H3a1 1 0 01-1-1V3zm2 1h12v12H4V4z",clipRule:"evenodd"})]})},o=e=>{let{className:t="h-5 w-5"}=e;return(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 2a2 2 0 00-2 2v1H6a2 2 0 00-2 2v7a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2V4a2 2 0 00-2-2zM8 4V3a1 1 0 112 0v1H8z",clipRule:"evenodd"})})},d=e=>{let{className:t="h-5 w-5"}=e;return(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 20l-4.95-6.05a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})})},c=e=>{let{className:t="h-5 w-5"}=e;return(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.415L11 9.586V6z",clipRule:"evenodd"})})},m=e=>{let{className:t="h-5 w-5"}=e;return(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})},x=e=>{let{className:t="h-5 w-5"}=e;return(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0012 11z",clipRule:"evenodd"})})},g=e=>{let{className:t="h-5 w-5"}=e;return(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})},h=e=>{let{className:t="h-8 w-8"}=e;return(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M12 2a10 10 0 0 0-10 10v2h20v-2a10 10 0 0 0-10-10z"}),(0,a.jsx)("path",{d:"M12 2v4"}),(0,a.jsx)("path",{d:"M22 14H2"})]})}},8987:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return C}});var a,r,n=s(5893),l=s(7294),i=s(9008),o=s.n(i),d=s(6976);let c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e4,[t,s]=(0,l.useState)(new Date);return(0,l.useEffect)(()=>{s(new Date);let t=setInterval(()=>{s(new Date)},e);return()=>{clearInterval(t)}},[e]),t};(a=r||(r={})).VEG="Veg",a.NON_VEG="Non-Veg";var m=s(6258);let x=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=new Date(e),a=e.getDay(),r=e.getDate()-a+(0===a?-6:1);return s.setDate(r+7*t),s.setHours(0,0,0,0),Array.from({length:5},(e,t)=>{let a=new Date(s);return a.setDate(s.getDate()+t),a})},g=e=>{let t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(s,"-").concat(a)},h=e=>e.toLocaleString("en-US",{weekday:"long",month:"long",day:"numeric"}),u=e=>{let{id:t,onClose:s}=e,a="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=".concat(encodeURIComponent(t));return(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4",onClick:s,children:(0,n.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-sm w-full shadow-2xl text-center transform transition-all scale-100",onClick:e=>e.stopPropagation(),children:[(0,n.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"Scan for Meal"}),(0,n.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Show this to the canteen staff."}),(0,n.jsx)("div",{className:"flex justify-center bg-gray-50 p-4 rounded-lg border border-gray-100 mb-4",children:(0,n.jsx)("img",{src:a,alt:"Meal QR Code",className:"w-48 h-48 object-contain"})}),(0,n.jsxs)("p",{className:"text-xs text-gray-400 font-mono mb-6 break-all",children:["ID: ",t]}),(0,n.jsx)("button",{onClick:s,className:"w-full py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg transition-colors",children:"Close"})]})})},p=e=>{let{onAddEntries:t,existingEntryForDate:s,currentTime:a,entries:i,onCancelEntry:o}=e,[d,c]=(0,l.useState)("book"),p={employeeId:"",employeeName:"",vertical:"",reportingManager:"",location:"",shiftTimings:"",mealType:r.VEG},[y,f]=(0,l.useState)(p),[b,j]=(0,l.useState)([]),[w,N]=(0,l.useState)(""),[v,k]=(0,l.useState)(""),[S,C]=(0,l.useState)(!1),[M,T]=(0,l.useState)(0),[E,D]=(0,l.useState)(!1),[I,_]=(0,l.useState)(!1),[R,L]=(0,l.useState)(null),[P,F]=(0,l.useState)(null),[V,z]=(0,l.useState)(!1),A=[4,5,6,0].includes(a.getDay()),X=(0,l.useMemo)(()=>x(a,V?1:0),[a,V]),B=async e=>{if(!e){T(0);return}_(!0);try{let t=await fetch("/api/points?employeeId=".concat(e));if(t.ok){let e=await t.json();T(e.points)}else{let t=localStorage.getItem("userPoints");if(t){let s=JSON.parse(t);T(s[e]||0)}else T(0)}}catch(s){let t=localStorage.getItem("userPoints");t?T(JSON.parse(t)[e]||0):T(0)}finally{_(!1)}};(0,l.useEffect)(()=>{let e=setTimeout(()=>{y.employeeId&&B(y.employeeId)},500);return()=>clearTimeout(e)},[y.employeeId]);let O=e=>{let{name:t,value:s}=e.target,a="employeeId"===t?s.trim():s;f(e=>({...e,[t]:a}))},G=e=>{let{value:t,checked:s}=e.target;j(e=>s?[...e,t].sort():e.filter(e=>e!==t))};(0,l.useEffect)(()=>{let e=document.createElement("script");return e.src="https://checkout.razorpay.com/v1/checkout.js",e.async=!0,document.body.appendChild(e),()=>{e.parentNode&&e.parentNode.removeChild(e)}},[]);let H=async(e,t,s)=>{let a=await fetch("/api/razorpay/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e,currency:"INR"})});if(!a.ok)throw Error("Failed to initiate payment order");let r=await a.json();if(void 0===window.Razorpay)throw Error("Razorpay SDK not loaded. Please check your internet connection.");let n={key:r.key,amount:r.amount,currency:r.currency,name:"Meal Planner",description:"Meal Booking Payment",order_id:r.id,handler:async function(a){C(!0);let r=await fetch("/api/razorpay/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({razorpay_order_id:a.razorpay_order_id,razorpay_payment_id:a.razorpay_payment_id,razorpay_signature:a.razorpay_signature,entries:t,amount:e,redeemPoints:s})}),n=await r.json();r.ok?(k("Payment Successful! Meals Booked. Payment ID: ".concat(a.razorpay_payment_id)),f(p),j([]),D(!1),setTimeout(()=>B(y.employeeId),500),window.location.reload()):N(n.message||"Payment verification failed."),C(!1)},prefill:{name:y.employeeName,email:"".concat(y.employeeId,"@c5i.com"),contact:"8310083237"},theme:{color:"#4F46E5"}},l=new window.Razorpay(n);l.on("payment.failed",function(e){N("Payment Failed: ".concat(e.error.description)),C(!1)}),l.open()};function U(e){return(e===r.NON_VEG||"Non_Veg"===e?r.NON_VEG:r.VEG)===r.NON_VEG?70:45}let W=async e=>{if(e.preventDefault(),N(""),k(""),C(!0),0===b.length){N("Please select at least one date."),C(!1);return}for(let e in y)if("mealType"!==e&&""===y[e]){N("All fields must be filled out."),C(!1);return}let a=b.filter(e=>s(e,y.employeeId));if(a.length>0){N("An entry for Employee ID ".concat(y.employeeId," already exists for: ").concat(a.join(", "),".")),C(!1);return}let n=b.map(e=>{let t=new Date("".concat(e,"T12:00:00")).getDay();return{date:e,employeeId:y.employeeId,employeeName:y.employeeName,vertical:y.vertical,reportingManager:y.reportingManager,location:y.location,shiftTimings:y.shiftTimings,mealType:y.mealType===r.NON_VEG&&(3===t||5===t)?r.NON_VEG:r.VEG}}),l=n.reduce((e,t)=>e+U(t.mealType),0),i=E?Math.min(M,l):0,o=Math.max(0,l-i);if(o>0)try{await H(o,n,i);return}catch(e){N(e.message||"Payment initialization failed."),C(!1);return}let d=await t(n,i);d.success?(k("Meal(s) successfully booked for ".concat(b.length," day(s)! ").concat(i>0?"Redeemed ".concat(i," point(s)."):"")),setTimeout(()=>{k("")},1e4),f(p),j([]),D(!1),setTimeout(()=>B(y.employeeId),500)):N(d.message||"An unknown error occurred."),C(!1)},q=async(e,t,s)=>{if(e.preventDefault(),e.stopPropagation(),window.confirm("Are you sure you want to cancel this meal entry? You will receive ".concat(U(s.mealType)," reward point."))){L(t);try{await o(t)&&setTimeout(()=>{B(y.employeeId)},1e3)}catch(e){console.error("Cancel failed",e),alert("Failed to cancel entry.")}finally{L(null)}}},J=(e,t)=>{e.preventDefault(),F(t)},Q=(0,l.useMemo)(()=>y.employeeId?i.filter(e=>e.employeeId===y.employeeId).sort((e,t)=>e.date.localeCompare(t.date)):[],[i,y.employeeId]),Y=b.map(e=>{let t=new Date("".concat(e,"T12:00:00")).getDay();return y.mealType===r.NON_VEG&&(3===t||5===t)?70:45}).reduce((e,t)=>e+t,0),K=E?Math.min(M,Y):0,Z=Math.max(0,Y-K),$=E?M-K:M;return(0,n.jsxs)(n.Fragment,{children:[P&&(0,n.jsx)(u,{id:P,onClose:()=>F(null)}),(0,n.jsxs)("div",{className:"bg-white p-1 rounded-2xl shadow-lg w-full max-w-3xl mx-auto overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex border-b border-gray-200",children:[(0,n.jsx)("button",{type:"button",className:"flex-1 py-4 text-center font-medium transition-colors duration-200 ".concat("book"===d?"text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50/50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"),onClick:()=>c("book"),children:"Book Meal"}),(0,n.jsx)("button",{type:"button",className:"flex-1 py-4 text-center font-medium transition-colors duration-200 ".concat("manage"===d?"text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50/50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"),onClick:()=>c("manage"),children:"My Bookings / Cancel"})]}),(0,n.jsx)("div",{className:"p-6 md:p-8",children:"book"===d?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-6 text-center",children:"Book Weekly Meals"}),w&&(0,n.jsx)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded-md",role:"alert",children:(0,n.jsx)("p",{children:w})}),v&&(0,n.jsx)("div",{className:"bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-4 rounded-md",role:"alert",children:(0,n.jsx)("p",{children:v})}),(0,n.jsxs)("form",{onSubmit:W,className:"space-y-6",children:[(0,n.jsxs)("div",{className:"md:col-span-2",children:[A&&(0,n.jsx)("button",{type:"button",onClick:()=>z(e=>!e),className:"mb-4 px-4 py-2 bg-indigo-600 text-white text-sm rounded-md hover:bg-indigo-700",children:V?"Show This Week":"Next Week"}),(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Dates"}),(0,n.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:X.map(e=>{let t=g(e),s=b.includes(t),r=new Date(a);r.setHours(0,0,0,0);let l=e<r,i=e.getTime()===r.getTime()&&a.getHours()>=9,o=l||i;return(0,n.jsxs)("label",{htmlFor:"date-".concat(t),className:"flex items-center p-3 rounded-lg border transition-all duration-200 ".concat(s?"bg-indigo-50 border-indigo-500 ring-2 ring-indigo-200":"bg-white border-gray-300"," ").concat(o?"bg-gray-100 cursor-not-allowed text-gray-400":"hover:border-indigo-400 cursor-pointer"),children:[(0,n.jsx)("input",{type:"checkbox",id:"date-".concat(t),name:"dates",value:t,checked:s,onChange:G,disabled:o,className:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 disabled:text-gray-400"}),(0,n.jsxs)("span",{className:"ml-3 text-sm font-medium",children:[h(e),i&&(0,n.jsx)("span",{className:"text-xs ml-1",children:"(Closed)"}),l&&(0,n.jsx)("span",{className:"text-xs ml-1",children:"(Past)"})]})]},t)})}),X.some(e=>e.toDateString()===a.toDateString()&&a.getHours()>=9)&&(0,n.jsx)("p",{className:"text-xs text-orange-600 mt-2",children:"Note: Submissions for today are closed after 9 AM."})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"employeeId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee ID"}),(0,n.jsxs)("div",{className:"relative group",children:[(0,n.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none transition-colors duration-200 text-gray-400 group-focus-within:text-indigo-600",children:(0,n.jsx)(m.Xw,{className:"h-5 w-5"})}),(0,n.jsx)("input",{type:"text",name:"employeeId",id:"employeeId",value:y.employeeId,onChange:O,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm pl-10 py-2.5 transition-colors duration-200",placeholder:"e.g., 12345"})]}),y.employeeId&&(0,n.jsx)("div",{className:"mt-1 flex items-center gap-1 text-xs text-indigo-600 font-medium",children:(0,n.jsxs)("span",{children:["\uD83C\uDFC6 Rewards: ",I?"...":M," Points"]})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"employeeName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee Name"}),(0,n.jsxs)("div",{className:"relative group",children:[(0,n.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none transition-colors duration-200 text-gray-400 group-focus-within:text-indigo-600",children:(0,n.jsx)(m.tB,{className:"h-5 w-5"})}),(0,n.jsx)("input",{type:"text",name:"employeeName",id:"employeeName",value:y.employeeName,onChange:O,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm pl-10 py-2.5 transition-colors duration-200",placeholder:"e.g., Kabir Singh"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"vertical",className:"block text-sm font-medium text-gray-700 mb-1",children:"Vertical"}),(0,n.jsxs)("div",{className:"relative group",children:[(0,n.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none transition-colors duration-200 text-gray-400 group-focus-within:text-indigo-600",children:(0,n.jsx)(m.Vp,{className:"h-5 w-5"})}),(0,n.jsx)("input",{type:"text",name:"vertical",id:"vertical",value:y.vertical,onChange:O,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm pl-10 py-2.5 transition-colors duration-200",placeholder:"e.g., Tech"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"reportingManager",className:"block text-sm font-medium text-gray-700 mb-1",children:"Reporting Manager"}),(0,n.jsxs)("div",{className:"relative group",children:[(0,n.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none transition-colors duration-200 text-gray-400 group-focus-within:text-indigo-600",children:(0,n.jsx)(m.tB,{className:"h-5 w-5"})}),(0,n.jsx)("input",{type:"text",name:"reportingManager",id:"reportingManager",value:y.reportingManager,onChange:O,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm pl-10 py-2.5 transition-colors duration-200",placeholder:"e.g., Rocky"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"location",className:"block text-sm font-medium text-gray-700 mb-1",children:"Location"}),(0,n.jsxs)("div",{className:"relative group",children:[(0,n.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none transition-colors duration-200 text-gray-400 group-focus-within:text-indigo-600",children:(0,n.jsx)(m.IS,{className:"h-5 w-5"})}),(0,n.jsx)("input",{type:"text",name:"location",id:"location",value:y.location,onChange:O,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm pl-10 py-2.5 transition-colors duration-200",placeholder:"e.g., 5th Floor"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"shiftTimings",className:"block text-sm font-medium text-gray-700 mb-1",children:"Shift Timings"}),(0,n.jsxs)("div",{className:"relative group",children:[(0,n.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none transition-colors duration-200 text-gray-400 group-focus-within:text-indigo-600",children:(0,n.jsx)(m.T3,{className:"h-5 w-5"})}),(0,n.jsx)("input",{type:"text",name:"shiftTimings",id:"shiftTimings",value:y.shiftTimings,onChange:O,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm pl-10 py-2.5 transition-colors duration-200",placeholder:"e.g., 9:00 AM - 6:00 PM"})]})]}),(0,n.jsxs)("div",{className:"md:col-span-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Meal Type"}),(0,n.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,n.jsxs)("label",{className:"flex items-center cursor-pointer group",children:[(0,n.jsx)("input",{type:"radio",name:"mealType",value:r.VEG,checked:y.mealType===r.VEG,onChange:O,className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),(0,n.jsx)("span",{className:"ml-2 text-gray-700 group-hover:text-indigo-600 transition-colors",children:"Veg"})]}),(0,n.jsxs)("label",{className:"flex items-center cursor-pointer group",children:[(0,n.jsx)("input",{type:"radio",name:"mealType",value:r.NON_VEG,checked:y.mealType===r.NON_VEG,onChange:O,className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),(0,n.jsx)("span",{className:"ml-2 text-gray-700 group-hover:text-indigo-600 transition-colors",children:"Non-Veg"})]})]}),(0,n.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Non-Veg is automatically selected on Wednesdays & Fridays if chosen."})]}),M>0&&(0,n.jsxs)("div",{className:"md:col-span-2 bg-indigo-50 rounded-lg p-4 border border-indigo-100 flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"bg-indigo-100 p-2 rounded-full mr-3",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("h4",{className:"font-semibold text-indigo-900",children:["Reward Points Available: ",$]}),(0,n.jsx)("p",{className:"text-xs text-indigo-700",children:"Use points to pay for your meal."})]})]}),(0,n.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,n.jsx)("input",{type:"checkbox",checked:E,onChange:e=>D(e.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),(0,n.jsx)("span",{className:"ml-2 text-sm font-medium text-indigo-800",children:"Redeem Points"})]})]}),b.length>0&&(0,n.jsxs)("div",{className:"md:col-span-2 border-t pt-4 mt-2",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center text-sm mb-1",children:[(0,n.jsx)("span",{className:"text-gray-600",children:"Total Meals:"}),(0,n.jsx)("span",{className:"font-semibold",children:b.length})]}),E&&(0,n.jsxs)("div",{className:"flex justify-between items-center text-sm mb-1",children:[(0,n.jsx)("span",{className:"text-gray-600",children:"Meal Cost:"}),(0,n.jsxs)("span",{className:"font-semibold",children:["₹",Y]})]}),K>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center text-sm mb-1 text-green-600",children:[(0,n.jsx)("span",{children:"Points Redeemed:"}),(0,n.jsxs)("span",{className:"font-semibold",children:["-",K]})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center text-sm mb-1 text-gray-600",children:[(0,n.jsx)("span",{children:"Remaining Points:"}),(0,n.jsx)("span",{className:"font-semibold",children:$})]})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center text-lg mt-2",children:[(0,n.jsx)("span",{className:"font-bold text-gray-800",children:"Total Payable:"}),(0,n.jsxs)("span",{className:"font-bold text-indigo-600",children:["₹",Z]})]})]})]}),(0,n.jsx)("button",{type:"submit",disabled:S,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200 transform hover:scale-[1.01] ".concat(S?"opacity-50 cursor-not-allowed hover:scale-100":""),children:S?(0,n.jsxs)("span",{className:"flex items-center",children:[(0,n.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Z>0?"Processing Payment...":"Booking..."]}):(0,n.jsx)("span",{children:Z>0?"Pay ₹".concat(Z," & Book"):"Book Meal"})})]})]}):(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"text-center mb-6",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:"My Bookings & Cancellations"}),(0,n.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Enter your Employee ID to view and manage your booked meals."})]}),(0,n.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[(0,n.jsx)("label",{htmlFor:"manageEmployeeId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Enter Employee ID"}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("input",{type:"text",id:"manageEmployeeId",name:"employeeId",value:y.employeeId,onChange:O,placeholder:"e.g., 12345",className:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm pl-4 py-2"}),I&&(0,n.jsx)("span",{className:"absolute right-3 top-2.5 text-xs text-gray-400",children:"Loading..."})]})]}),y.employeeId&&(0,n.jsx)("div",{className:"bg-green-50 text-green-800 p-3 rounded-md text-sm font-medium flex items-center justify-center border border-green-100",children:(0,n.jsxs)("span",{children:["\uD83C\uDFC6 You have ",(0,n.jsx)("span",{className:"font-bold text-lg mx-1",children:M})," Reward Points!"]})}),y.employeeId&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("h3",{className:"font-semibold text-gray-700 mb-3 border-b pb-2",children:"Upcoming Meals"}),0===Q.length?(0,n.jsx)("p",{className:"text-gray-500 text-sm italic text-center py-4",children:"No meals found for this Employee ID."}):(0,n.jsx)("ul",{className:"space-y-3",children:Q.map(e=>(0,n.jsxs)("li",{className:"bg-white border rounded-lg p-3 flex justify-between items-center shadow-sm hover:shadow-md transition-shadow ".concat(e.isRedeemed?"opacity-60 bg-gray-50 border-gray-200":"border-gray-200"),children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-medium text-indigo-700",children:h(new Date(e.date))}),(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:[e.mealType," • ",e.location]}),e.isRedeemed&&(0,n.jsx)("span",{className:"text-xs bg-gray-200 text-gray-600 px-1.5 py-0.5 rounded mt-1 inline-block",children:"Redeemed"}),"Online"===e.paymentMethod&&(0,n.jsx)("span",{className:"text-xs bg-green-100 text-green-700 px-1.5 py-0.5 rounded mt-1 ml-1 inline-block",children:"Paid Online"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[!e.isRedeemed&&(0,n.jsxs)("button",{type:"button",onClick:t=>J(t,e.id),className:"text-xs px-3 py-1.5 rounded text-indigo-700 bg-indigo-50 border border-indigo-200 font-medium hover:bg-indigo-100 transition-colors flex items-center gap-1",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4h2v-4zM6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"QR"]}),(0,n.jsx)("button",{type:"button",onClick:t=>q(t,e.id,e),disabled:R===e.id||e.isRedeemed,className:"text-xs px-3 py-1.5 rounded text-white font-medium transition-colors ".concat(R===e.id||e.isRedeemed?"bg-gray-400 cursor-not-allowed":"bg-red-500 hover:bg-red-600"),children:R===e.id?"...":"Cancel"})]})]},e.id))})]})]})})]})]})},y=e=>{let{date:t,entries:s,onCancelEntry:a,currentTime:i,isAdmin:o=!1,onDownload:d}=e,[c,x]=(0,l.useState)(null),g=s.filter(e=>e.mealType===r.VEG).length,h=s.filter(e=>e.mealType===r.NON_VEG).length,u=s.length,p=new Date("".concat(t,"T12:00:00")).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),y=async(e,t)=>{if(e.preventDefault(),e.stopPropagation(),window.confirm("Are you sure you want to cancel this entry?")){x(t);try{let e=a(t);e instanceof Promise&&await e}catch(e){console.error("Cancel failed",e),alert("An error occurred while cancelling.")}finally{x(null)}}};return(0,n.jsxs)("div",{className:"bg-white p-6 rounded-2xl shadow-lg mb-8",children:[(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 border-b pb-4 border-gray-200",children:[(0,n.jsxs)("div",{className:"flex items-center mb-3 sm:mb-0",children:[(0,n.jsx)(m.Qu,{className:"h-6 w-6 text-indigo-500 mr-3"}),(0,n.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:p})]}),(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-2 text-sm mt-3 sm:mt-0",children:[(0,n.jsxs)("span",{className:"font-semibold text-gray-700",children:["Total: ",(0,n.jsx)("span",{className:"text-indigo-600",children:u})]}),(0,n.jsxs)("span",{className:"font-semibold text-green-700",children:["Veg: ",(0,n.jsx)("span",{className:"text-green-600",children:g})]}),(0,n.jsxs)("span",{className:"font-semibold text-red-700",children:["Non-Veg: ",(0,n.jsx)("span",{className:"text-red-600",children:h})]}),o&&d&&(0,n.jsxs)("button",{type:"button",onClick:d,className:"inline-flex items-center gap-1.5 bg-gray-100 text-gray-700 font-semibold py-1.5 px-3 rounded-md shadow-sm hover:bg-gray-200 transition-colors duration-200 text-xs","aria-label":"Download entries for ".concat(p),children:[(0,n.jsx)(m._8,{className:"h-4 w-4"}),"Download"]})]})]}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Scanner ID"}),(0,n.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),(0,n.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell",children:"Vertical"}),(0,n.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Manager"}),(0,n.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Meal Type"}),(0,n.jsx)("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,n.jsx)("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,n.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(e=>(0,n.jsxs)("tr",{className:e.isRedeemed?"bg-gray-50":"",children:[(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-xs text-gray-500 font-mono select-all",children:e.id}),(0,n.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,n.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.employeeName}),(0,n.jsx)("div",{className:"text-sm text-gray-500",children:e.employeeId})]}),(0,n.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap hidden md:table-cell",children:[(0,n.jsx)("div",{className:"text-sm text-gray-900",children:e.vertical}),(0,n.jsx)("div",{className:"text-sm text-gray-500",children:e.location})]}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 hidden lg:table-cell",children:e.reportingManager}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full w-min ".concat(e.mealType===r.VEG?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.mealType}),"Points"===e.paymentMethod&&(0,n.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-indigo-100 text-indigo-800 w-min",children:"Paid w/ Points"})]})}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.isRedeemed?(0,n.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-bold rounded-full bg-green-200 text-green-900 border border-green-300",children:"Completed"}):(0,n.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800 border border-yellow-200",children:"Pending"})}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:(0,n.jsxs)("button",{type:"button",onClick:t=>y(t,e.id),disabled:c===e.id||e.isRedeemed,className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200 ".concat(c===e.id||e.isRedeemed?"bg-gray-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700"),title:e.isRedeemed?"Already Redeemed":"Cancel and earn 1 point","aria-label":"Cancel meal for ".concat(e.employeeName),children:[(0,n.jsx)(m.XH,{className:"h-4 w-4 mr-1.5"}),c===e.id?"...":"Cancel"]})})]},e.id))})]})})]})},f=e=>{let{entries:t,onCancelEntry:s,currentTime:a,isAdmin:r=!1,onDownloadDate:i}=e,o=t.reduce((e,t)=>{let s=t.date;return e[s]||(e[s]=[]),e[s].push(t),e},{}),d=Object.keys(o).sort(),[c,m]=(0,l.useState)(0);if(0===t.length)return(0,n.jsxs)("div",{className:"text-center py-10 bg-white rounded-2xl shadow-lg mt-12",children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-800",children:"No Meal Entries Yet"}),(0,n.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:r?"Add an entry using the form above.":"Submit the form to book your first meal."})]});let x=d[c],g=o[x];return(0,n.jsxs)("div",{className:"w-full max-w-7xl mx-auto mt-12",children:[(0,n.jsx)("h2",{className:"text-3xl font-bold text-black text-center mb-6",children:(0,n.jsx)("span",{className:"bg-white px-3 py-2 rounded-md inline-block",children:r?"All Meal Entries":"Your Meal Bookings"})}),(0,n.jsxs)("div",{className:"flex justify-center items-center gap-6 mb-6",children:[(0,n.jsx)("button",{onClick:()=>m(e=>Math.max(e-1,0)),disabled:0===c,className:"px-4 py-2 rounded-xl border font-semibold transition-all duration-300\n      ".concat(0===c?"border-gray-400 text-gray-400 cursor-not-allowed":"border-indigo-500  bg-indigo-500 text-white hover:bg-indigo-500 hover:text-white hover:shadow-lg"),children:"Previous"}),(0,n.jsx)("button",{onClick:()=>m(e=>Math.min(e+1,d.length-1)),disabled:c===d.length-1,className:"px-4 py-2 rounded-xl border font-semibold transition-all duration-300\n      ".concat(c===d.length-1?"border-gray-400 text-gray-400 cursor-not-allowed":"border-indigo-500 bg-indigo-500 text-white hover:bg-indigo-500 hover:text-white hover:shadow-lg"),children:"Next"})]}),(0,n.jsx)(y,{date:x,entries:g,onCancelEntry:s,currentTime:a,isAdmin:r,onDownload:i?()=>i(x):void 0})]})},b=e=>{let t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(s,"-").concat(a)},j=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=XLSX.utils.aoa_to_sheet(e),a={font:{color:{rgb:"FFFFFF"},bold:!0},fill:{patternType:"solid",fgColor:{rgb:"4F46E5"}}},r=XLSX.utils.decode_range(s["!ref"]);for(let e=r.s.c;e<=r.e.c;++e){let r=XLSX.utils.encode_cell({c:e,r:t});s[r]&&(s[r].s=a)}let n=e[0].map((t,s)=>({wch:Math.max(...e.map(e=>e[s]?String(e[s]).length:0))+5}));return s["!cols"]=n,s},w=e=>{let{onAddSingleEntry:t,existingEntryForDate:s}=e,a={date:b(new Date),employeeId:"",employeeName:"",vertical:"",reportingManager:"",location:"",shiftTimings:"",mealType:r.VEG},[i,o]=(0,l.useState)(a),[d,c]=(0,l.useState)(""),[m,x]=(0,l.useState)(""),[g,h]=(0,l.useState)(!1),u=e=>{let{name:t,value:s}=e.target;o(e=>({...e,[t]:s}))},p=async e=>{if(e.preventDefault(),c(""),x(""),h(!0),Object.values(i).some(e=>""===e)){c("All fields are required."),h(!1);return}if(s(i.date,i.employeeId)){c("An entry for Employee ID ".concat(i.employeeId," already exists for ").concat(i.date,".")),h(!1);return}let r=await t(i);r.success?(x("Entry for ".concat(i.employeeName," on ").concat(i.date," added successfully.")),o(a)):c(r.message||"An unknown error occurred."),h(!1)};return(0,n.jsxs)("div",{className:"bg-white p-6 md:p-8 rounded-2xl shadow-lg w-full max-w-4xl mx-auto border border-indigo-100",children:[(0,n.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-6 text-center",children:"Add New Meal Entry"}),d&&(0,n.jsx)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded-md",role:"alert",children:(0,n.jsx)("p",{children:d})}),m&&(0,n.jsx)("div",{className:"bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-4 rounded-md",role:"alert",children:(0,n.jsx)("p",{children:m})}),(0,n.jsxs)("form",{onSubmit:p,className:"space-y-4",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700",children:"Date"}),(0,n.jsx)("input",{type:"date",name:"date",id:"date",value:i.date,onChange:u,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"employeeId",className:"block text-sm font-medium text-gray-700",children:"Employee ID"}),(0,n.jsx)("input",{type:"text",name:"employeeId",id:"employeeId",value:i.employeeId,onChange:u,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"employeeName",className:"block text-sm font-medium text-gray-700",children:"Employee Name"}),(0,n.jsx)("input",{type:"text",name:"employeeName",id:"employeeName",value:i.employeeName,onChange:u,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"vertical",className:"block text-sm font-medium text-gray-700",children:"Vertical"}),(0,n.jsx)("input",{type:"text",name:"vertical",id:"vertical",value:i.vertical,onChange:u,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"reportingManager",className:"block text-sm font-medium text-gray-700",children:"Reporting Manager"}),(0,n.jsx)("input",{type:"text",name:"reportingManager",id:"reportingManager",value:i.reportingManager,onChange:u,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2",placeholder:"e.g., Rocky"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"location",className:"block text-sm font-medium text-gray-700",children:"Location"}),(0,n.jsx)("input",{type:"text",name:"location",id:"location",value:i.location,onChange:u,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"shiftTimings",className:"block text-sm font-medium text-gray-700",children:"Shift Timings"}),(0,n.jsx)("input",{type:"text",name:"shiftTimings",id:"shiftTimings",value:i.shiftTimings,onChange:u,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2"})]}),(0,n.jsxs)("div",{className:"md:col-span-2",children:[(0,n.jsx)("label",{htmlFor:"mealType",className:"block text-sm font-medium text-gray-700",children:"Meal Type"}),(0,n.jsxs)("select",{id:"mealType",name:"mealType",value:i.mealType,onChange:u,className:"mt-1 block w-full p-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm",children:[(0,n.jsx)("option",{value:r.VEG,children:r.VEG}),(0,n.jsx)("option",{value:r.NON_VEG,children:r.NON_VEG})]})]})]}),(0,n.jsx)("button",{type:"submit",disabled:g,className:"w-full inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-gray-400",children:g?"Adding...":"Add Entry"})]})]})},N=e=>{let{onRefresh:t,onRedeemEntry:s}=e,[a,r]=(0,l.useState)(""),[i,o]=(0,l.useState)(null),[d,c]=(0,l.useState)(null),[m,x]=(0,l.useState)(!1),[g,h]=(0,l.useState)(!1),[u,p]=(0,l.useState)(""),y=(0,l.useRef)(!0),f=(0,l.useRef)(null);(0,l.useEffect)(()=>(y.current=!0,()=>{y.current=!1}),[]);let b=async e=>{if(e.trim()){x(!0);try{let n=await s(e.trim());if(y.current){if(c(n),n.success){var a;r(""),o(null),h(!1);let s=(null===(a=n.entry)||void 0===a?void 0:a.id)||e.trim();t&&t(s)}else o(null)}}catch(e){y.current&&(c({success:!1,message:"Processing failed. Please try again."}),o(null))}finally{y.current&&x(!1)}}},j=e=>{let t=(null==e?void 0:e.name)||"",s="string"==typeof e?e:(null==e?void 0:e.message)||JSON.stringify(e);return"NotAllowedError"===t||"PermissionDeniedError"===t||s.toLowerCase().includes("permission denied")||s.toLowerCase().includes("not allowed")||s.toLowerCase().includes("permission dismissed")},w=async()=>{p("");try{(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(e=>e.stop()),setTimeout(()=>{y.current&&h(!0)},500)}catch(e){console.error("Permission request failed",e),j(e)?p("Permission denied. Please allow camera access in your browser settings."):p("Could not access camera: "+(e.message||"Unknown error"))}};return(0,l.useEffect)(()=>{if(!g)return;p("");let e="reader";if("undefined"==typeof Html5Qrcode){p("Scanner library not loaded. Please refresh the page.");return}let t=!1;return(async()=>{if(await new Promise(e=>setTimeout(e,300)),!t&&document.getElementById(e))try{f.current=new Html5Qrcode(e,{verbose:!1});let s=e=>{if(t||!y.current)return;let s=e.trim();o(e=>e||s)},a={fps:25,qrbox:{width:250,height:250}};try{await f.current.start({facingMode:"environment"},a,s,void 0)}catch(e){if(t)return;if(j(e)){p("Permission denied. Please allow camera access in your browser settings.");return}try{await f.current.start({facingMode:"user"},a,s,void 0)}catch(e){j(e)?p("Permission denied. Please allow camera access in your browser settings."):p("Failed to start camera. Please check your device.")}}}catch(e){if(t)return;p("Failed to initialize scanner: "+((null==e?void 0:e.message)||"Unknown error"))}})(),()=>{t=!0,f.current&&(async()=>{try{f.current.isScanning&&await f.current.stop()}catch(e){}finally{try{f.current.clear()}catch(e){}}})()}},[g]),(0,n.jsxs)("div",{className:"bg-white p-6 md:p-8 rounded-2xl shadow-lg w-full max-w-4xl mx-auto border-2 border-dashed border-gray-300 mb-8",children:[(0,n.jsxs)("h3",{className:"text-xl font-bold text-gray-800 mb-4 text-center flex items-center justify-center gap-2",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4h2v-4zM6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2-2h-2v4a2 2 0 002 2z"})}),"Meal Scanner"]}),(0,n.jsx)("p",{className:"text-center text-gray-500 text-sm mb-6",children:"Scan the employee's QR code using the camera or a handheld scanner."}),(0,n.jsx)("div",{className:"flex justify-center mb-6",children:!g&&(0,n.jsx)("button",{type:"button",onClick:w,className:"inline-flex items-center px-4 py-2 border border-indigo-300 rounded-md shadow-sm text-sm font-medium text-indigo-700 bg-indigo-50 hover:bg-indigo-100 focus:outline-none transition-colors",children:"Start Camera Scan"})}),g&&(0,n.jsxs)("div",{className:"mb-6 mx-auto overflow-hidden rounded-lg border-2 border-gray-800 bg-black h-72 w-full max-w-sm relative shadow-inner flex flex-col items-center justify-center",children:[(0,n.jsx)("div",{id:"reader",className:"w-full h-full absolute inset-0"}),!i&&!u&&(0,n.jsxs)("div",{className:"absolute inset-0 pointer-events-none border-2 border-indigo-500/30 flex items-center justify-center",children:[(0,n.jsx)("div",{className:"w-64 h-64 border-2 border-indigo-400 rounded-lg animate-pulse"}),(0,n.jsx)("div",{className:"absolute top-4 bg-black/40 text-white text-xs px-2 py-1 rounded",children:"Scanning..."})]}),i&&(0,n.jsx)("div",{className:"absolute inset-0 z-30 flex flex-col items-center justify-center bg-black/80 p-4 animate-in fade-in duration-200",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg p-4 w-full text-center shadow-2xl",children:[(0,n.jsx)("h4",{className:"font-bold text-gray-900 text-lg mb-1",children:"Meal ID Detected"}),(0,n.jsx)("p",{className:"font-mono text-sm bg-gray-100 p-2 rounded mb-4 break-all text-gray-700 select-all",children:i}),(0,n.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,n.jsx)("button",{onClick:()=>{i&&b(i)},disabled:m,className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition-colors disabled:opacity-50",children:m?"Processing...":"Complete"}),(0,n.jsx)("button",{onClick:()=>{o(null),c(null)},disabled:m,className:"flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded transition-colors",children:"Cancel"})]})]})}),(0,n.jsx)("button",{onClick:()=>h(!1),className:"absolute top-2 right-2 p-2 bg-black/50 text-white rounded-full hover:bg-red-600 hover:text-white transition-colors z-40",title:"Close Camera",children:(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),u&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center p-4 bg-gray-900 bg-opacity-90 text-white text-center z-50",children:(0,n.jsx)("p",{children:u})})]}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),b(a)},className:"max-w-md mx-auto flex gap-2",children:[(0,n.jsx)("input",{type:"text",value:a,onChange:e=>r(e.target.value),placeholder:"Or type Meal ID manually...",className:"flex-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-3",autoFocus:!g}),(0,n.jsx)("button",{type:"submit",disabled:m||!a,className:"inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:m?"...":"Redeem"})]}),d&&(0,n.jsxs)("div",{className:"mt-6 p-4 rounded-md text-center transition-all duration-300 ".concat(d.success?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"),children:[(0,n.jsx)("p",{className:"font-bold text-lg",children:d.message}),d.entry&&(0,n.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:[(0,n.jsxs)("p",{className:"font-semibold",children:[d.entry.employeeName," (",d.entry.employeeId,")"]}),(0,n.jsxs)("p",{children:[d.entry.mealType," - ",d.entry.date]})]})]})]})},v=e=>{let{entries:t,onAddSingleEntry:s,existingEntryForDate:a,onCancelEntry:i,currentTime:o,onRefresh:d,onRedeemEntry:c}=e,[x,g]=(0,l.useState)("entries"),[h,u]=(0,l.useState)([]),[p,y]=(0,l.useState)([]);(0,l.useEffect)(()=>{"transactions"===x&&fetch("/api/admin/transactions").then(e=>e.json()).then(e=>Array.isArray(e)?u(e):u([])).catch(e=>console.error("Transactions fetch error",e)),"feedback"===x&&fetch("/api/admin/feedback").then(e=>e.json()).then(e=>Array.isArray(e)?y(e):y([])).catch(e=>console.error("Feedback fetch error",e))},[x]);let b=t.filter(e=>e.isRedeemed);return(0,n.jsxs)("div",{className:"space-y-8",children:[(0,n.jsx)("div",{className:"flex flex-wrap justify-center mb-6 gap-2",children:(0,n.jsxs)("div",{className:"flex flex-wrap rounded-md shadow-sm",role:"group",children:[(0,n.jsx)("button",{type:"button",onClick:()=>g("entries"),className:"px-4 py-2 text-sm font-medium border border-gray-200 rounded-l-lg ".concat("entries"===x?"bg-indigo-600 text-white":"bg-white text-gray-900 hover:bg-gray-100"),children:"Manage Entries"}),(0,n.jsx)("button",{type:"button",onClick:()=>g("scanner"),className:"px-4 py-2 text-sm font-medium border-t border-b border-r border-gray-200 ".concat("scanner"===x?"bg-indigo-600 text-white":"bg-white text-gray-900 hover:bg-gray-100"),children:"Scanner"}),(0,n.jsx)("button",{type:"button",onClick:()=>g("transactions"),className:"px-4 py-2 text-sm font-medium border-t border-b border-r border-gray-200 ".concat("transactions"===x?"bg-indigo-600 text-white":"bg-white text-gray-900 hover:bg-gray-100"),children:"Transactions"}),(0,n.jsx)("button",{type:"button",onClick:()=>g("redemptions"),className:"px-4 py-2 text-sm font-medium border-t border-b border-r border-gray-200 ".concat("redemptions"===x?"bg-indigo-600 text-white":"bg-white text-gray-900 hover:bg-gray-100"),children:"Redemptions"}),(0,n.jsx)("button",{type:"button",onClick:()=>g("feedback"),className:"px-4 py-2 text-sm font-medium border border-gray-200 rounded-r-lg ".concat("feedback"===x?"bg-indigo-600 text-white":"bg-white text-gray-900 hover:bg-gray-100"),children:"Feedback"})]})}),"entries"===x&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsxs)("button",{onClick:()=>{if("undefined"==typeof XLSX){alert("Excel library is not loaded yet.");return}let e=t.reduce((e,t)=>{let s=t.date;return e[s]||(e[s]=[]),e[s].push(t),e},{}),s=XLSX.utils.book_new();for(let t of Object.keys(e).sort()){let a=e[t],n=["Date","Scanner ID","Employee ID","Employee Name","Vertical","Reporting Manager","Location","Shift Timings","Meal Type","Status"],l=a.map(e=>[e.date,e.id,e.employeeId,e.employeeName,e.vertical,e.reportingManager,e.location,e.shiftTimings,e.mealType,e.isRedeemed?"Completed":"Pending"]),i=j([n,...l,[],["","","","","","","","Total Veg:",a.filter(e=>e.mealType===r.VEG).length],["","","","","","","","Total Non-Veg:",a.filter(e=>e.mealType===r.NON_VEG).length],["","","","","","","","Total Meals:",a.length]]);XLSX.utils.book_append_sheet(s,i,t)}XLSX.writeFile(s,"meal_entries_by_date.xlsx")},className:"inline-flex items-center gap-2 bg-green-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-green-700 transition-colors duration-200",disabled:0===t.length,children:[(0,n.jsx)(m._8,{}),"Download All Entries"]})}),(0,n.jsx)(w,{onAddSingleEntry:s,existingEntryForDate:a}),(0,n.jsx)(f,{entries:t,onCancelEntry:i,currentTime:o,isAdmin:!0,onDownloadDate:e=>{if("undefined"==typeof XLSX)return;let s=t.filter(t=>t.date===e);if(0===s.length){alert("No entries to download for this date.");return}let a=j([["Date","Scanner ID","Employee ID","Employee Name","Vertical","Reporting Manager","Location","Shift Timings","Meal Type","Status"],...s.map(e=>[e.date,e.id,e.employeeId,e.employeeName,e.vertical,e.reportingManager,e.location,e.shiftTimings,e.mealType,e.isRedeemed?"Completed":"Pending"])]),r=XLSX.utils.book_new();XLSX.utils.book_append_sheet(r,a,e),XLSX.writeFile(r,"meal_entries_".concat(e,".xlsx"))}})]}),"scanner"===x&&(0,n.jsx)(N,{onRefresh:d,onRedeemEntry:c}),"transactions"===x&&(0,n.jsxs)("div",{className:"bg-white p-6 rounded-2xl shadow-lg",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"Payment Transactions"}),(0,n.jsxs)("button",{onClick:()=>{if("undefined"==typeof XLSX)return;let e=j([["Date","Payment ID","Order ID","Employee ID","Amount (INR)","Created At"],...h.map(e=>[e.date,e.razorpay_payment_id,e.razorpay_order_id,e.employeeId,(e.amount/100).toFixed(2),new Date(e.createdAt).toLocaleString()])]),t=XLSX.utils.book_new();XLSX.utils.book_append_sheet(t,e,"Transactions"),XLSX.writeFile(t,"Transactions.xlsx")},className:"inline-flex items-center gap-1.5 bg-gray-100 text-gray-700 font-semibold py-1.5 px-3 rounded-md hover:bg-gray-200 text-sm",children:[(0,n.jsx)(m._8,{className:"h-4 w-4"})," Download"]})]}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Payment ID"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Employee"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Amount"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Time"})]})}),(0,n.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===h.length?(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:5,className:"px-6 py-4 text-center text-gray-500",children:"No transactions found."})}):h.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.date}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-600",children:e.razorpay_payment_id}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.employeeId}),(0,n.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-bold text-green-600",children:["₹",(e.amount/100).toFixed(2)]}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.createdAt).toLocaleString()})]},e.id))})]})})]}),"redemptions"===x&&(0,n.jsxs)("div",{className:"bg-white p-6 rounded-2xl shadow-lg",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"Redemption Log"}),(0,n.jsxs)("button",{onClick:()=>{if("undefined"==typeof XLSX)return;let e=j([["Date","Meal ID","Employee ID","Name","Meal Type","Redeemed At"],...b.map(e=>[e.date,e.id,e.employeeId,e.employeeName,e.mealType,e.redeemedAt?new Date(e.redeemedAt).toLocaleString():"N/A"])]),t=XLSX.utils.book_new();XLSX.utils.book_append_sheet(t,e,"Redemptions"),XLSX.writeFile(t,"Redemptions.xlsx")},className:"inline-flex items-center gap-1.5 bg-gray-100 text-gray-700 font-semibold py-1.5 px-3 rounded-md hover:bg-gray-200 text-sm",children:[(0,n.jsx)(m._8,{className:"h-4 w-4"})," Download"]})]}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Employee"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Meal Type"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Redeemed At"})]})}),(0,n.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===b.length?(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:4,className:"px-6 py-4 text-center text-gray-500",children:"No redemptions found."})}):b.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.date}),(0,n.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.employeeName," (",e.employeeId,")"]}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.mealType}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.redeemedAt?new Date(e.redeemedAt).toLocaleString():"-"})]},e.id))})]})})]}),"feedback"===x&&(0,n.jsxs)("div",{className:"bg-white p-6 rounded-2xl shadow-lg",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"User Feedback"}),(0,n.jsxs)("button",{onClick:()=>{if("undefined"==typeof XLSX)return;let e=j([["Date","Category","Rating","Message"],...p.map(e=>[new Date(e.createdAt).toLocaleString(),e.category,e.rating||"N/A",e.message])]),t=XLSX.utils.book_new();XLSX.utils.book_append_sheet(t,e,"Feedback"),XLSX.writeFile(t,"Feedback.xlsx")},className:"inline-flex items-center gap-1.5 bg-gray-100 text-gray-700 font-semibold py-1.5 px-3 rounded-md hover:bg-gray-200 text-sm",children:[(0,n.jsx)(m._8,{className:"h-4 w-4"})," Download"]})]}),(0,n.jsx)("div",{className:"grid gap-4",children:0===p.length?(0,n.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No feedback received yet."}):p.map(e=>(0,n.jsxs)("div",{className:"border border-gray-100 rounded-lg p-4 hover:shadow-sm transition-shadow",children:[(0,n.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"font-bold text-gray-800",children:e.category}),e.rating&&(0,n.jsxs)("span",{className:"bg-yellow-100 text-yellow-800 text-xs font-semibold px-2 py-0.5 rounded",children:["Rating: ",e.rating,"/5"]})]}),(0,n.jsx)("span",{className:"text-xs text-gray-400",children:new Date(e.createdAt).toLocaleString()})]}),(0,n.jsx)("p",{className:"text-gray-600 text-sm",children:e.message})]},e.id))})]})]})},k=e=>{let{onLoginAttempt:t,onClose:s}=e,[a,r]=(0,l.useState)(""),[i,o]=(0,l.useState)(""),[d,c]=(0,l.useState)("");return(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center","aria-modal":"true",role:"dialog",children:(0,n.jsxs)("div",{className:"bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm m-4",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-800 text-center mb-6",children:"Admin Login"}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),c(""),t(a,i)||c("Invalid username or password.")},className:"space-y-6",children:[d&&(0,n.jsx)("p",{className:"text-red-500 text-sm text-center bg-red-100 p-2 rounded-md",children:d}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700",children:"Username"}),(0,n.jsx)("input",{type:"text",id:"username",value:a,onChange:e=>r(e.target.value),required:!0,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2.5"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),(0,n.jsx)("input",{type:"password",id:"password",value:i,onChange:e=>o(e.target.value),required:!0,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2.5"})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,n.jsx)("button",{type:"button",onClick:s,className:"w-full inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"}),(0,n.jsx)("button",{type:"submit",className:"w-full inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Login"})]})]})]})})},S=e=>fetch(e).then(e=>e.json());var C=()=>{let{data:e=[],error:t,mutate:s}=(0,d.ZP)("/api/meals",S),a=c(),[r,i]=(0,l.useState)(!1),[x,g]=(0,l.useState)(!1),h=(0,l.useCallback)(async e=>{e&&await s(t=>t?t.map(t=>t.id===e?{...t,isRedeemed:!0}:t):[],{revalidate:!1}),s()},[s]),u=(0,l.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{let a=await fetch("/api/meals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entries:e,redeemPoints:t})});if(!a.ok){let e=await a.json();throw Error(e.message||"Failed to add entries")}return await s(),{success:!0}}catch(e){return{success:!1,message:e.message}}},[s]),y=(0,l.useCallback)(async e=>u([e]),[u]),f=(0,l.useCallback)(async e=>{try{let t=await fetch("/api/meals/".concat(encodeURIComponent(e)),{method:"DELETE"});if(!t.ok){let e=await t.json();throw Error(e.message||"Failed to cancel entry.")}return await s(),!0}catch(e){return console.error("Cancel Error:",e.message),alert(e.message||"Failed to cancel entry"),!1}},[s]),b=(0,l.useCallback)(async e=>{try{let t=await fetch("/api/meals/redeem",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})});return await t.json()}catch(e){return{success:!1,message:"Network connection failed."}}},[]),j=(0,l.useCallback)((t,s)=>!!e&&e.some(e=>e.date===t&&e.employeeId===s),[e]);return t?(0,n.jsx)("div",{className:"text-center text-red-500",children:"Failed to load meal entries. Please try again later."}):(0,n.jsxs)("div",{className:"bg-gray-50 min-h-screen font-sans flex flex-col meal-form",style:{backgroundImage:"url('/office.jpg')",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:[(0,n.jsxs)(o(),{children:[(0,n.jsx)("title",{children:"Meal Planner AI Agent"}),(0,n.jsx)("meta",{name:"description",content:"An AI-powered agent to manage daily meal requests for employees."}),(0,n.jsx)("link",{rel:"icon",href:"https://www.c5i.ai/wp-content/uploads/Asset-1@2x.png"})]}),x&&(0,n.jsx)(k,{onLoginAttempt:(e,t)=>"admin"===e&&"admin"===t&&(i(!0),g(!1),!0),onClose:()=>g(!1)}),(0,n.jsx)("header",{className:"bg-white shadow-sm sticky top-0 z-10 border-b-black",children:(0,n.jsx)("nav",{className:"container px-2 w-full h-full mx-auto",children:(0,n.jsxs)("div",{className:"flex flex-wrap items-center py-2",children:[(0,n.jsx)("div",{className:"flex flex-1 justify-center md:justify-start items-center",children:(0,n.jsx)("img",{src:"/logo.png",alt:"MealPlanner Logo",className:"h-12 sm:h-16 md:h-18 w-24 sm:w-28 md:w-32 object-contain"})}),(0,n.jsxs)("div",{className:"flex flex-1 flex-col md:flex-row justify-center items-center gap-1 sm:gap-2 text-center",children:[(0,n.jsx)("img",{src:"/nxtdaybite2.png",alt:"Next Day Bite Logo",className:"h-8 sm:h-10 md:h-12 w-8 sm:w-10 md:w-10 object-contain"}),(0,n.jsx)("h1",{className:"text-xl sm:text-3xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-[linear-gradient(to_right,#6939a8_0%,#6939a8_45%,#397bad_50%,#397bad_100%)]",children:"Next Day Bite"})]}),(0,n.jsx)("div",{className:"flex flex-1 justify-center md:justify-end items-center",children:(0,n.jsx)("img",{src:"/AE_C5i_Logo.png",alt:"MealPlanner Logo",className:"h-12 sm:h-16 md:h-20 w-24 sm:w-28 md:w-32 object-contain"})})]})})}),(0,n.jsx)("div",{className:"container mx-auto px-4 pt-4",children:(0,n.jsx)("div",{className:"flex justify-end",children:r?(0,n.jsxs)("button",{onClick:()=>{i(!1)},className:"flex items-center gap-2 bg-red-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-red-600 transition-colors duration-200",children:[(0,n.jsx)(m.R0,{}),"Logout"]}):(0,n.jsxs)("button",{onClick:()=>g(!0),className:"flex items-center gap-2 bg-white text-gray-700 font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-gray-100 transition-colors duration-200 border",children:[(0,n.jsx)(m.lM,{}),"Admin Login"]})})}),(0,n.jsx)("main",{className:"container mx-auto px-4 py-6 md:py-8 flex-grow",children:r?(0,n.jsx)(v,{entries:e,onAddSingleEntry:y,existingEntryForDate:j,onCancelEntry:f,currentTime:a,onRefresh:h,onRedeemEntry:b}):(0,n.jsx)(p,{onAddEntries:u,existingEntryForDate:j,currentTime:a,entries:e,onCancelEntry:f})}),(0,n.jsx)("footer",{className:"bg-slate-800 text-white py-2 mt-2",children:(0,n.jsxs)("div",{className:"container mx-auto px-4",children:[(0,n.jsxs)("div",{className:"flex flex-col md:flex-row justify-between gap-8 text-left",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-bold mb-4 uppercase tracking-wider text-gray-200",children:"Support"}),(0,n.jsxs)("ul",{className:"space-y-3 text-sm text-gray-400",children:[(0,n.jsx)("li",{children:(0,n.jsx)("a",{href:"/feedback",className:"hover:text-white",children:"Feedback"})}),(0,n.jsx)("li",{children:(0,n.jsx)("a",{href:"/contact",className:"hover:text-white",children:"Contact Us"})})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-bold mb-4 uppercase tracking-wider text-gray-200",children:"Policies"}),(0,n.jsxs)("ul",{className:"space-y-3 text-sm text-gray-400",children:[(0,n.jsx)("li",{children:(0,n.jsx)("a",{href:"/terms",className:"hover:text-white",children:"Terms and Conditions"})}),(0,n.jsx)("li",{children:(0,n.jsx)("a",{href:"/cancellation",className:"hover:text-white",children:"Cancellation and Refunds"})})]})]})]}),(0,n.jsx)("div",{className:"flex flex-col items-center  text-center",children:(0,n.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:["\xa9 ",new Date().getFullYear()," Next Day Bite by c5i  All rights reserved."]})})]})})]})}}},function(e){e.O(0,[799,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);